---
title: "Smith_Test"
author: "Raymond L. Tremblay"
date: "9/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Smith's Test

Test originally described by Cedric A. B. Smith but apparently has only been published in Gruneberg et al 1966. Here described by Leigh Van Valen 2005 in the book "Variation"
ed. Benedikt Hallgr√≠msson and Brian K. Hall.

In the first part is by hand then I use summarise from plyr package to calculate the different parts of the function

```{r}
library(lawstat)
library(ggplot2)
library(BioStatR)
library(reshape)
library(e1071)
library(QuantPsyc)
library(boot)
library(MASS)
library(ggplot2)

library(plyr)
```

```{r}
Red.Cell.Size.in.Humans <- read.csv("~/Google Drive/Topicos-2016/DATA Analysis for presentation/Roy-Haldane Conjucture/Red Cell Size in Humans.csv")
RBC=Red.Cell.Size.in.Humans
RBC
head(RBC)
summary(RBC)
names(RBC)

RBC2=untable(RBC[,c(1,2)],num=RBC[,3])
head(RBC2)
names(RBC2)
```

```{r}
dfCV=ddply(RBC2, "IND", summarise, 
           RBC.mean=mean(Cell_Size, na.rm=TRUE),
           RBC.medium=median(Cell_Size, na.rm=TRUE),
           RBC.sd=sd(Cell_Size, na.rm=TRUE),
           RBC.var=var(Cell_Size, na.rm=TRUE),
           RBC.sk=skewness(Cell_Size, na.rm=TRUE, type = 3),
           RBC.ku=kurtosis(Cell_Size, na.rm=TRUE, type = 2),
           RBC.sd4=RBC.sd^4,
           sumdif4=sum((signif((Cell_Size-RBC.mean)^4,4))),
           Length=NROW(Cell_Size[!is.na(Cell_Size)]),
           RBC.se=RBC.sd/sqrt(Length),
           tfrac=qt(p=.90, df=Length-1), 
           LowerLL=RBC.mean-tfrac*RBC.sd/sqrt(Length),
           UpperLL=RBC.mean+tfrac*RBC.sd/sqrt(Length),
           CV=100*(RBC.sd/RBC.medium),
           RBC.CVunb=100*((1+1/(4*Length))*RBC.sd/RBC.medium),
           RBC.CVunb4=RBC.CVunb^4,
           s2x=(sumdif4-RBC.sd4*((Length-3)/Length))/((Length-2)*(Length-3)),
           p11=RBC.sd4/s2x,
           p22=RBC.var/s2x,
           p33=1/s2x,

           s2cv=(RBC.CVunb^2)/(2*Length), 
           s2cvp11=RBC.CVunb^2/s2cv, # part 1
           s2cvp22=RBC.CVunb/s2cv,  # [part 2]
           s2cvp33=1/s2cv # part 3
)
dfCV
```


```{r}
l1=sum(dfCV$p11)
l1
l2=sum(dfCV$p22)
l2
l3=sum(dfCV$p33)
l3
```


```{r}
ChiS=l1-l2^2/l3
ChiS

qchisq(0.95,df=6)
```


```{r}
l1=sum(dfCV$s2cvp11)
l1
l2=(sum(dfCV$s2cvp22))^2
l2
l3=sum(dfCV$s2cvp33)
l3
ChiS=l1-(l2/l3)
ChiS
```



```{r}
dfRBC2=ddply(RBC2, "IND", summarise, 
             RBC.mean=mean(Cell_Size, na.rm=TRUE),
             RBC.medium=median(Cell_Size, na.rm=TRUE),
             RBC.sd=sd(Cell_Size, na.rm=TRUE),
             RBC.var=var(Cell_Size, na.rm=TRUE),
             RBC.sk=skewness(Cell_Size, na.rm=TRUE, type = 3),
             RBC.ku=kurtosis(Cell_Size, na.rm=TRUE, type = 2),
             RBC.sd4=RBC.sd^4,
             sumdif4=sum((signif((Cell_Size-RBC.mean)^4,4))),
             Length=NROW(Cell_Size[!is.na(Cell_Size)]),
             RBC.se=RBC.sd/sqrt(Length),
             tfrac=qt(p=.90, df=Length-1), 
             LowerLL=RBC.mean-tfrac*RBC.sd/sqrt(Length),
             UpperLL=RBC.mean+tfrac*RBC.sd/sqrt(Length),
             CV=100*(RBC.sd/RBC.medium),
             RBC.CVunb=100*((1+1/(4*Length))*RBC.sd/RBC.medium),
             RBC.CVunb4=RBC.CVunb^4,
             s2x=(sumdif4-RBC.sd4*((Length-3)/Length))/((Length-2)*(Length-3)),
             p11=RBC.sd4/s2x,
             p22=RBC.var/s2x,
             p33=1/s2x,
             
             s2cv=(RBC.CVunb^2)/(2*Length), 
             s2cvp11=RBC.CVunb^2/s2cv, # part 1
             s2cvp22=RBC.CVunb/s2cv,  # [part 2]
             s2cvp33=1/s2cv # part 3
)

dfRBC2

```

```{r}
l1=sum(dfRBC2$s2cvp11)
l1
l2=(sum(dfRBC2$s2cvp22))^2
l2
l3=sum(dfRBC2$s2cvp33)
l3
ChiS=l1-(l2/l3)
ChiS
qchisq(0.95,df=7)
```

## Minimum example of Smith's Test


```{r}
df_Smiths=ddply(RBC2, "IND", summarise, 
             RBC.mean=mean(Cell_Size, na.rm=TRUE),
             RBC.sd=sd(Cell_Size, na.rm=TRUE),
             RBC.var=var(Cell_Size, na.rm=TRUE),
             RBC.sd4=RBC.sd^4,
             sumdif4=sum((signif((Cell_Size-RBC.mean)^4,4))),
             Length=NROW(Cell_Size[!is.na(Cell_Size)]),
             RBC.se=RBC.sd/sqrt(Length),
             tfrac=qt(p=.90, df=Length-1), 
             LowerLL=RBC.mean-tfrac*RBC.sd/sqrt(Length),
             UpperLL=RBC.mean+tfrac*RBC.sd/sqrt(Length),
             CV=100*(RBC.sd/RBC.mean),
             RBC.CVunb=100*((1+1/(4*Length))*RBC.sd/RBC.mean),
             RBC.CVunb4=RBC.CVunb^4,
             s2x=(sumdif4-RBC.sd4*((Length-3)/Length))/((Length-2)*(Length-3)),
             p11=RBC.sd4/s2x,
             p22=RBC.var/s2x,
             p33=1/s2x,
             s2cv=(RBC.CVunb^2)/(2*Length), 
             s2cvp11=RBC.CVunb^2/s2cv, # [part 1]
             s2cvp22=RBC.CVunb/s2cv,  # [part 2]
             s2cvp33=1/s2cv # [part 3]
)

dfRBC2

```


```{r}
library(cvequality)
```



```{r}
x <- rnorm(100)
y <- unlist(lapply(letters[1:5], function(i) rep(i, 20)))
df=cbind(x,y)
df
mslr_test(nr = 1e3, x, y)
```

IND
<int>
Cell_Size
<dbl>



```{r}
mslr_test(nr = 1e3, RBC2$Cell_Size, RBC2$IND)


asymptotic_test(RBC2$Cell_Size, RBC2$IND)
```



